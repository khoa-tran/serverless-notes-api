service: serverless-notes-api

# Use serverless-webpack plugin to transpile ES6/ES7
plugins:
  - serverless-webpack

# Enable auto-packing of external modules
custom:
  webpackIncludeModules: true

provider:
  name: aws
  runtime: nodejs6.10
  stage: prod
  region: us-west-2

  # 'iamRoleStatements' defines the permission policy for the Lambda function.
  # In this case Lambda functions are granted with permissions to access DynamoDB
  iamRoleStatements:
      - Effect: Allow
        Action:
            - dynamodb: DescribeTable
            - dynamodb: Query
            - dynamodb: Scan
            - dynamodb: GetItem
            - dynamodb: PutItem
            - dynamodb: UpdateItem
            - dynamodb: DeleteItem
        Resource: "arn:aws:dynamodb:us-west-2:*:*"

functions:
    # Defines an HTTP API endpoint that calls the main function in create.js
    # - path: url path is /notes
    # - method: POST request
    # - cors: enabled CORS (Cross-Origin Resource Sharing) for browser cross domain api call
    # - authorizer: authenticate the api via Cognito User Pool
    create:
        handler: create.main
        events:
            - http:
                path: notes
                method: post
                cors: true
                authorizer:
                    arn: arn:aws:cognito-idp:us-west-2:596310897400:userpool/us-west-2_IJDrpYgOj
    # Defines an HTTP API endpoint that calls the main function in get.js
    # - path: url path is /notes/{id}
    # - method: GET request
    # - cors: enabled CORS (Cross-Origin Resource Sharing) for browser cross domain api call
    # - authorizer: authenticate the api via Cognito User Pool
    get:
        handler: get.main
        events:
            - http:
                path: notes/{id}
                method: get
                cors: true
                authorizer:
                    arn: arn:aws:cognito-idp:us-west-2:596310897400:userpool/us-west-2_IJDrpYgOj
    # Defines an HTTP API endpoint that calls the main function in list.js
    # - path: url path is /notes
    # - method: GET request
    # - cors: enabled CORS (Cross-Origin Resource Sharing) for browser cross domain api call
    # - authorizer: authenticate the api via Cognito User Pool
    list:
        handler: list.main
        events:
            - http:
                path: notes
                method: get
                cors: true
                authorizer:
                    arn: arn:aws:cognito-idp:us-west-2:596310897400:userpool/us-west-2_IJDrpYgOj
    # Defines an HTTP API endpoint that calls the main function in update.js
    # - path: url path is /notes/{id}
    # - method: PUT request
    update:
        handler: update.main
        events:
            - http:
                path: notes/{id}
                method: put
                cors: true
                authorizer:
                    arn: arn:aws:cognito-idp:us-west-2:596310897400:userpool/us-west-2_IJDrpYgOj
